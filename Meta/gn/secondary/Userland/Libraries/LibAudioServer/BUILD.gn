import("//Meta/gn/build/compiled_action.gni")

compiled_action("ToSessionClientFromAudioServerEndpoint") {
  tool = "//Meta/Lagom/Tools/CodeGenerators/IPCCompiler"
  inputs = [
    "//Userland/Libraries/LibAudioServer/ToSessionClientFromAudioServer.ipc",
  ]
  outputs = [
    "$root_gen_dir/LibAudioServer/ToSessionClientFromAudioServerEndpoint.h",
  ]
  args = [
    rebase_path(inputs[0], root_build_dir),
    "-o",
    rebase_path(outputs[0], root_build_dir),
  ]
}

compiled_action("ToBrokerFromAudioServerEndpoint") {
  tool = "//Meta/Lagom/Tools/CodeGenerators/IPCCompiler"
  inputs = [ "//Userland/Libraries/LibAudioServer/ToBrokerFromAudioServer.ipc" ]
  outputs = [ "$root_gen_dir/LibAudioServer/ToBrokerFromAudioServerEndpoint.h" ]
  args = [
    rebase_path(inputs[0], root_build_dir),
    "-o",
    rebase_path(outputs[0], root_build_dir),
  ]
}

compiled_action("ToAudioServerFromBrokerEndpoint") {
  tool = "//Meta/Lagom/Tools/CodeGenerators/IPCCompiler"
  inputs = [ "//Userland/Libraries/LibAudioServer/ToAudioServerFromBroker.ipc" ]
  outputs = [ "$root_gen_dir/LibAudioServer/ToAudioServerFromBrokerEndpoint.h" ]
  args = [
    rebase_path(inputs[0], root_build_dir),
    "-o",
    rebase_path(outputs[0], root_build_dir),
  ]
}

compiled_action("ToAudioServerFromSessionClientEndpoint") {
  tool = "//Meta/Lagom/Tools/CodeGenerators/IPCCompiler"
  inputs = [
    "//Userland/Libraries/LibAudioServer/ToAudioServerFromSessionClient.ipc",
  ]
  outputs = [
    "$root_gen_dir/LibAudioServer/ToAudioServerFromSessionClientEndpoint.h",
  ]
  args = [
    rebase_path(inputs[0], root_build_dir),
    "-o",
    rebase_path(outputs[0], root_build_dir),
  ]
}

shared_library("LibAudioServer") {
  output_name = "audioserver"
  include_dirs = [
    "//Userland/Libraries",
    "//Userland/Services",
    "//Userland/",
  ]
  deps = [
    ":ToAudioServerFromBrokerEndpoint",
    ":ToAudioServerFromSessionClientEndpoint",
    ":ToBrokerFromAudioServerEndpoint",
    ":ToSessionClientFromAudioServerEndpoint",
    "//AK",
    "//Userland/Libraries/LibCore",
    "//Userland/Libraries/LibIPC",
    "//Userland/Libraries/LibMedia",
    "//Userland/Libraries/LibThreading",
  ]
  sources = [
    "BrokerOfAudioServer.cpp",
    "LibAudioServer.cpp",
    "SessionClientOfAudioServer.cpp",
    "SharedCircularBuffer.cpp",
    "SingleSinkSessionClient.cpp",
  ]
  sources += get_target_outputs(":ToSessionClientFromAudioServerEndpoint") +
             get_target_outputs(":ToBrokerFromAudioServerEndpoint") +
             get_target_outputs(":ToAudioServerFromBrokerEndpoint") +
             get_target_outputs(":ToAudioServerFromSessionClientEndpoint")
}
