<!DOCTYPE html>
<script src="./include.js"></script>
<script>
    asyncTest(async (done) => {
        try {
            const httpServer = httpTestServer();
            const url = await httpServer.createEcho("GET", "/test-http-test-server", {
                status: 200,
                headers: {
                    "Access-Control-Allow-Origin": "*",  // necessary when running test using file://...
                    "Access-Control-Expose-Headers": "X-Custom-Header", // tells the browser which headers to expose to JS
                    "Content-Type": "text/plain",
                    "X-Custom-Header": "well hello friends",
                },
                body: "hello world!",
            });
            const result = await fetch(url);
            const headers = result.headers;

            if (headers.get("X-Custom-Header") === "well hello friends") {
                println("PASS (json)");
            } else {
                println("FAIL (json)");
            }

            const binaryUrl = await httpServer.createBinaryEcho("GET", "/test-http-test-server-binary", {
                status: 200,
                headers: {
                    "Access-Control-Allow-Origin": "*",  // necessary when running test using file://...
                    "Access-Control-Expose-Headers": "X-Custom-Header-For-Binary", // tells the browser which headers to expose to JS
                    "Content-Type": "text/plain",
                    "X-Custom-Header-For-Binary": "well hello friends",
                },
                body: "hello world!!!",
            });

            const binaryResult = await fetch(binaryUrl);
            const binaryHeaders = binaryResult.headers;

            if (binaryHeaders.get("X-Custom-Header-For-Binary") === "well hello friends") {
                println("PASS (binary)");
            } else {
                println("FAIL (binary)");
            }
        } catch (err) {
            println("FAIL - " + err);
        }
        done();
    });
</script>
