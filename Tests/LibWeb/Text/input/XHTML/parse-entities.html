<!DOCTYPE html>
<meta charset=utf-8>
<script src="../include.js"></script>
<script>
  const parser = new DOMParser();
  const parse = parser.parseFromString.bind(parser);
  const entities = {
    "&Aacute;": { "codepoints": [193], "characters": "\u00C1" },
    "&aacute;": { "codepoints": [225], "characters": "\u00E1" },
  }

  // Adapted from https://wpt.live/html/the-xhtml-syntax/parsing-xhtml-documents/xhtml-mathml-dtd-entity-1.htm
  test(() => {
    for (const entityStr in entities) {
        const expectedString = entities[entityStr].characters
        const source = `<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "foo"><html><head></head><body id='test'>${entityStr}</body></html>`
        const doc = parse(source, 'application/xhtml+xml')
        const root = doc.getElementById('test')
        const text = root.firstChild.data
        for (var i = 0, len = expectedString.length; i < len; i++) {
          if(text.charCodeAt(i) !== expectedString.charCodeAt(i)) {
            println(`FAIL`)
            return
          }
        }
    }
    println("PASS")
  })
</script>
