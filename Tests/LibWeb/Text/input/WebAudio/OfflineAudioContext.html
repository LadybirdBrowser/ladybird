<!DOCTYPE html>
<script src="../include.js"></script>
<script>
    asyncTest(async done => {
        // Once the ctorâ€‘offlineaudiocontext WPT test is updated to check
        // renderQuantumSize and renderSizeHint, this test is not needed.
        const audioContext = new OfflineAudioContext(1, 1, 44100)
        println(`${audioContext.renderQuantumSize}`);

        // Listen for OfflineAudioCompletionEvent
        const eventPromise = new Promise(r => audioContext.addEventListener('complete', r));

        const buffer = await audioContext.startRendering();
        const audioCompletionEvent = await eventPromise;

        // Completion event should return rendered buffer
        println(audioCompletionEvent.renderedBuffer.length === buffer.length)

        // Second call must reject with InvalidStateError
        try {
            await audioContext.startRendering();
            println('FAIL: started rendering on repeated call');
        } catch (e) {
            println(`${e}`);
        }

        done();
    });
</script>
