<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Test Results</title>
    <style>
        body { font-family: system-ui, sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
        h1 { color: #333; }
        .summary { background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .test { margin: 10px 0; padding: 10px; border-left: 4px solid #ccc; }
        .test.fail { border-color: #e74c3c; background: #fdf2f2; }
        .test.timeout { border-color: #f39c12; background: #fef9e7; }
        .test.crashed { border-color: #9b59b6; background: #f5eef8; }
        .test.skipped { border-color: #95a5a6; background: #f8f9f9; }
        .test-header { display: flex; align-items: center; cursor: pointer; }
        .test-name { font-weight: bold; font-family: monospace; flex: 1; }
        .test-links { margin-top: 5px; }
        .test-links a, .test-links button { margin-right: 15px; color: #3498db; text-decoration: none; background: none; border: none; cursor: pointer; font-size: inherit; padding: 0; font-family: inherit; }
        .test-links a:hover, .test-links button:hover { text-decoration: underline; }
        .test-links button.active { font-weight: bold; }
        .result-type { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; margin-right: 10px; }
        .result-type.fail { background: #e74c3c; color: white; }
        .result-type.timeout { background: #f39c12; color: white; }
        .result-type.crashed { background: #9b59b6; color: white; }
        .result-type.skipped { background: #95a5a6; color: white; }
        .preview-frame { width: 100%; height: 400px; border: 1px solid #ccc; margin-top: 10px; display: none; background: white; }
        .preview-frame.visible { display: block; }
    </style>
</head>
<body>
    <h1>Test Results</h1>
    <div id="content">Loading...</div>
    <script src="results.js"></script>
    <script>
        function loadResults() {
            if (typeof RESULTS_DATA === 'undefined') {
                document.getElementById('content').textContent = 'Failed to load results: results.js not found';
                return;
            }
            renderResults(RESULTS_DATA);
        }

        function renderResults(data) {
            const content = document.getElementById('content');
            content.innerHTML = '';

            // Summary
            const summary = document.createElement('div');
            summary.className = 'summary';
            summary.innerHTML = `<strong>Non-passing tests:</strong> ${data.tests.length} total
                (${data.summary.fail} failed, ${data.summary.timeout} timeout, ${data.summary.crashed} crashed, ${data.summary.skipped} skipped)`;
            content.appendChild(summary);

            // Tests
            for (const test of data.tests) {
                const div = document.createElement('div');
                div.className = `test ${test.result}`;

                const header = document.createElement('div');
                header.className = 'test-header';
                header.innerHTML = `<span class="result-type ${test.result}">${test.result.toUpperCase()}</span>
                    <span class="test-name">${test.name}</span>`;
                div.appendChild(header);

                const links = document.createElement('div');
                links.className = 'test-links';

                const previewId = `preview-${test.name.replace(/[^a-zA-Z0-9]/g, '-')}`;

                const stdoutBtn = test.hasStdout ? `<button onclick="showPreview('${previewId}', '${test.name}.stdout.txt')">stdout</button>` : '';
                const stderrBtn = test.hasStderr ? `<button onclick="showPreview('${previewId}', '${test.name}.stderr.txt')">stderr</button>` : '';

                if (test.mode === 'Layout' || test.mode === 'Text') {
                    links.innerHTML = `
                        <button onclick="showPreview('${previewId}', '${test.name}.expected.txt')">Expected</button>
                        <button onclick="showPreview('${previewId}', '${test.name}.actual.txt')">Actual</button>
                        <button onclick="showPreview('${previewId}', '${test.name}.diff.txt')">Diff</button>
                        ${stdoutBtn}${stderrBtn}
                    `;
                } else if (test.mode === 'Ref') {
                    links.innerHTML = `
                        <button onclick="showPreview('${previewId}', '${test.name}.expected.png')">Expected</button>
                        <button onclick="showPreview('${previewId}', '${test.name}.actual.png')">Actual</button>
                        ${stdoutBtn}${stderrBtn}
                    `;
                } else {
                    links.innerHTML = `${stdoutBtn}${stderrBtn}`;
                }
                div.appendChild(links);

                const preview = document.createElement('iframe');
                preview.id = previewId;
                preview.className = 'preview-frame';
                div.appendChild(preview);

                content.appendChild(div);
            }
        }

        function showPreview(previewId, url) {
            const preview = document.getElementById(previewId);

            // Toggle off if clicking same button
            if (preview.dataset.currentUrl === url && preview.classList.contains('visible')) {
                preview.classList.remove('visible');
                preview.dataset.currentUrl = '';
                preview.src = '';
                return;
            }

            preview.dataset.currentUrl = url;
            preview.src = url;
            preview.classList.add('visible');
        }

        loadResults();
    </script>
</body>
</html>
